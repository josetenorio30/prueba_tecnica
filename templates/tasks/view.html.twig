{% extends 'base.html.twig' %}

{% block title %}Listado de Tareas{% endblock %}

{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        background-color: #f4f6f9;
    }
    .card {
        border-radius: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    h1 {
        font-weight: 600;
        color: #333;
    }
</style>
{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="card p-4">
        <h1 class="mb-4 text-center">ðŸ“‹ Listado de Tareas</h1>
        <div class="table-responsive">
            <table id="tasksTable" class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Proyecto</th>
                        <th>DescripciÃ³n</th>
                        <th>Tarifa</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5" class="text-center text-muted">Cargando datos...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const tbody = document.querySelector("#tasksTable tbody");

    fetch("/api/tasks")
        .then(res => {
            if (!res.ok) throw new Error("Error al cargar tareas");
            return res.json();
        })
        .then(tasks => {
            if (!tasks.length) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No hay tareas registradas.</td></tr>';
                return;
            }

            tbody.innerHTML = tasks.map(t => `
                <tr>
                    <td>${t.id}</td>
                    <td>${t.user ?? 'â€”'}</td>
                    <td>${t.project ?? 'â€”'}</td>
                    <td>${t.name ?? 'â€”'}</td>
                    <td>${t.rate ?? 'â€”'}</td>
                </tr>
            `).join('');
        })
        .catch(err => {
            console.error(err);
            tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error al cargar datos</td></tr>';
        });
});
</script>
{% endblock %}
